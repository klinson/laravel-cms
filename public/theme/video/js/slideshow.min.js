/*
	Copyright (c) 2012 Colin Rotherham, http://colinr.com
	https://github.com/colinrotherham
*/

	var CRD=CRD||{};
	CRD.Slideshow=function(S,F,G){function k(){d.isManual||(H=setTimeout(function(){g()},d.interval))}function w(){clearTimeout(I);clearTimeout(H)}function J(a){g(a,{isPrev:!1})}function K(a){g(a,{isPrev:!0})}function g(a,e){var c=$(this),f=e&&e.slide,g=b.index;if(!n){p=e&&e.isPrev;if(c.hasClass(d.classSlide)){if(c.is("a"))return;f=h.index(c)}T(f);b.slide.is(b.slideNext)||(n=!0,w(),((f=G?G.call(b,a):!0)||"undefined"===typeof f)&&u(z(g),d.isCarousel?d.time:0,function(){L(a)}))}a?c.is(b.slide)||a.preventDefault():
	k()}function u(a,e,c,f){null===a&&(a=z(b.index));e=e||0;if(U&&d.isCarousel){f=f||0;if(c)l.one(m.toLowerCase()+"TransitionEnd transitionend",c);q[m+"Transition"]=e?e/1E3+"s":"";q[m+"Transform"]="translateX("+-1*(r(a,!0)-f)+"%)"}else l.stop(!0,!0).animate({left:r(a)+"%"},e,c)}function L(a){b.slide=b.slideNext;n=!1;h.removeClass(d.classActive);b.slide.addClass(d.classActive);q[m+"Transition"]="";d.canLoop&&M();N();a&&("click"===a.type&&b.slide.focus(),F&&F.call(b,a))}function T(a){var e=b.index;"undefined"!==
	typeof a?(p=a<e?!0:!1,e=a):e=p?0===e?d.canLoop?c-1:0:e-1:e===c-1?d.canLoop?0:c-1:e+1;b.slideNext=h.eq(e);b.index=e}function O(){return!d.canLoop&&(p&&0===b.index||!p&&b.index===c-1)}function P(a){s&&(a?g(a,{slide:A.index(this)}):A.removeAttr("class").eq(b.index).addClass(d.classActive))}function N(){var a,e=d.classDisabled;if(!d.canLoop){x.removeClass(e);switch(b.index){case 0:a=B;break;case c-1:a=C}a&&a.addClass(e)}P()}function r(a,b){return b?100/c*a:-100*a}function Q(a){a>=c&&(a-=c);0>a&&(a=c+
	a);return a}function z(a){return Q(b.index+(d.canLoop?y-a:0))}function R(a){return Q(d.canLoop?a-y+b.index:a)}function M(){for(var a=c,e,f,g;a--;)e=h.eq(R(a)),f=e.data("x"),g=r(a,!0)+"%",g!==f&&e.css({left:g,display:d.display}).attr("tabindex","-1").data("x",g);u(d.canLoop?y:b.index)}function V(){var a,e;function h(f){var g=f.originalEvent,v=g.touches&&g.touches[0]||g;1<v.length||g.scale&&1!==g.scale||(a=(v.pageX||v.screenX)-k.x,e=(v.pageY||v.screenY)-k.y,"undefined"===typeof t&&(t=!!(t||Math.abs(a)<
	Math.abs(e))),t||(f.preventDefault(),w(),p=0<a,n=!0,!d.canLoop&&O()&&(a/=Math.abs(a)/b.width+1),u(null,null,null,a/b.width*(100/c))))}function l(){if(!t){var e=+new Date-k.time,c=Math.abs(a),e=250>e&&20<c||c>b.width/3;n=!1;e&&!O()?g(event,{isPrev:p}):0<c&&u(null,d.time)}f.off(q,h);f.off(r,l)}function m(a){D&&clearTimeout(D);D=setTimeout(function(){b.width=f.outerWidth()},a?300:0)}var k,q="touchmove MSPointerMove",r="touchend touchleave touchcancel MSPointerUp MSPointerOut";d.isCarousel=!0;f.on("touchstart MSPointerDown",
	function(b){var d=x||s&&s.add(x),c=b.originalEvent,c=c.touches&&c.touches[0]||c;d.has(b.target).length||d.is(b.target)||(n&&L(),k={x:c.pageX||c.screenX,y:c.pageY||c.screenY,time:+new Date},t=e=a=void 0,f.on(q,h),f.on(r,l))}).on("click",function(a){!t&&n&&a.preventDefault()}).addClass(d.classTouch);m();$(window).resize(m)}var b=this,E=["ms","O","Moz","Webkit",""],m="",q,d={next:"button.next",previous:"button.previous",classStrip:"strip",classSlide:"slide",classActive:"sticky",classMarkers:"markers",
	classDisabled:"disabled",classTouch:"touch",delay:3E3,interval:5E3,time:400,display:"block",canLoop:!1,isManual:!0,isCarousel:!0},f,h,l,s,A,x,B,C,I,H,D,c,y,n,t,p,U=function(){for(var a=document.body.style,b=E.length;b--;)if("string"===typeof a[E[b]+"Transition"]){m=E[b];break}return!!m}(),W="ontouchstart"in window||navigator.msPointerEnabled||window.DocumentTouch&&document instanceof DocumentTouch;$.each(S,function(a,b){d[a]=b});b.init=function(){f=$(d.slideshow);h=f.find("."+d.classSlide);l=f.find("."+
	d.classStrip);c=h.length;if(f.length&&!(2>c)){q=l[0].style;b.slide=h.filter("."+d.classActive);b.index=h.index(b.slide);b.slide.length||(b.index=0,b.slide=h.eq(b.index));y=d.canLoop?Math.floor((c-1)/2):0;l.width(100*c+"%");h.width(100/c+"%");W&&V();h.on("click touchend",g);f.mouseenter(w).mouseleave(k);C=f.find(d.next).on("click touchend",J);B=f.find(d.previous).on("click touchend",K);x=B.add(C);I=setTimeout(k,d.delay);if(d.classMarkers){s=$("<div />").addClass(d.classMarkers).on("click touchend",
	"button",P);for(var a=c;a--;)s.prepend($("<button>"+(a+1)+"</button>"));A=s.find("button");f.append(s)}N();M();b.element=f;b.strip=l;b.slides=h;f.removeClass(d.classDisabled)}};b.start=k;b.stop=w;b.next=J;b.prev=K;b.change=g;b.transition=u;b.getTransitionX=r;b.getIndexOffset=z;b.getPositionOffset=R};